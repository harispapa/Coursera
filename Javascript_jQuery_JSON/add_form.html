<!DOCTYPE html>
<html lang="en">
<head>
    <?php require_once "bootstrap.php"; ?>
    <?php if(isset($editPage) && $editPage === true) {?>
        <title>Charilaos Papamatthaiou's - 2a0e8414 - Edit Page</title>
    <?php } else { ?>
        <title>Charilaos Papamatthaiou's - 2a0e8414 - Add Page</title>
    <?php } ?>
</head>
<body>
<div class="container">
    <?php if(isset($editPage) && $editPage === true) {?>
       <h1>Editing Profile for UMSI</h1>
    <?php } else { ?>
       <h1>Adding Profile for UMSI</h1>
    <?php } ?>
    <?php displaySessionsErrors();?>
    <form method="post">
        <p>First Name:
            <label>
                <input name="first_name" size="60" type="text" value="<?php if(isset($row['first_name'])) echo htmlentities($row['first_name']); ?>">
            </label></p>
        <p>Last Name:
            <label>
                <input name="last_name" size="60" type="text" value="<?php if(isset($row['last_name'])) echo htmlentities($row['last_name']); ?>">
            </label></p>
        <p>Email:
            <label>
                <input name="email" size="30" type="text" value="<?php if(isset($row['email'])) echo htmlentities($row['email']); ?>">
            </label></p>
        <p>Headline:<br>
            <label>
                <input name="headline" size="80" type="text" value="<?php if(isset($row['headline'])) echo htmlentities($row['headline']); ?>">
            </label></p>
        <p>Summary:<br>
            <label>
                <textarea cols="80" name="summary" rows="8"><?php if(isset($row['summary'])) echo htmlentities($row['summary']); ?></textarea>
            </label>
        </p>
        <p>Education: <input id="addEdu" type="submit" value="+"></p>
        <div id="edu_fields">
            <?php if(isset($editPage) && $editPage === true) {?>
            <?php foreach($erows as $erow) {?>
                <?php foreach($irows as $irow) { ?>
                    <div id="edu_school<?php if (isset($erow['rank'])) echo $erow['rank'];?>">
                    <p>Year: <input name="edu_year<?php if (isset($erow['rank'])) echo $erow['rank'];?>" type="text" value="<?php if (isset($erow['year'])) echo $erow['year'];?>"/>
                        <input onclick="$('#edu_school<?php echo $erow['rank'];?>').remove(); return false;"type="button" value="-">
                    </p>
                    <p>School: <input  class="school" name="edu_school<?php if (isset($row['rank'])) echo $erow['rank'];?>" size="60" type="text" value="<?php if (isset($irow['name'])) echo $irow['name'];?>">
                    </p>
                </div>
                <?php } ?>
            <?php } ?>
            <?php } ?>
        </div>
        <p> Position: <input id="addPos" type="submit" value="+"></p>
        <div id="position_fields">
            <?php if(isset($editPage) && $editPage === true) {?>
                    <?php foreach($prows as $row) {?>
                        <div id="position<?php if (isset($row['rank'])) echo $row['rank'];?>">
                            <p>Year: <input name="year<?php if (isset($row['rank'])) echo $row['rank'];?>" type="text" value="<?php if (isset($row['year'])) echo $row['year'];?>"/>
                                <input onclick=" $('#position<?php echo $row['rank'];?>').remove(); return false;"type="button" value="-"></p>
                            <textarea cols="80" name="desc<?php if (isset($row['rank'])) echo $row['rank']; ?>" rows="8"><?php if (isset($row['description'])) echo htmlentities($row['description'])?></textarea>
                        </div>
                    <?php } ?>
            <?php } ?>
        </div>
        <p>
            <?php if(isset($editPage) && $editPage === true) {?>
                <input type="submit" value="Save">
            <?php } else { ?>
                <input type="submit" value="Add">
            <?php } ?>
            <input name="cancel" type="submit" value="Cancel">
       </p>
    </form>
</div>
<script>
    let countPos = 0;
    let countEdu = 0;
    function addEducationField(event) {
        event.preventDefault();
        if (countEdu >= 9) {
            alert("Maximum of nine position entries exceeded");
            return;
        }
        countEdu++;
        console.log('Adding schools: '+countEdu);
        $('#edu_fields').append(
            '<div id="edu_school' + countEdu + '"> \
             <p>Year: <input type="text" name="edu_year'+countEdu+'" value=""/> \
             <input type="button" value="-" onclick="$(\'#edu_school'+countEdu+'\').remove(); countEdu--; return false;"></p> \
             <p>School: <input type="text" size="60"  name="edu_school'+countEdu+'" value="" ></p> \
            </div>');
    }
    function addPositionField(event){
        event.preventDefault();
        if (countPos >= 9) {
            alert("Maximum of nine position entries exceeded");
            return;
        }
        countPos++;
        console.log('Adding position: '+countPos);
        $('#position_fields').append(
            '<div id="position' + countPos + '"> \
             <p>Year: <input type="text" name="year'+countPos+'" value=""/> \
             <input type="button" value="-" onclick="$(\'#position'+countPos+'\').remove(); countPos--; return false;"></p> \
             <textarea name="desc'+countPos+'" cols="80" rows="8"></textarea> \
             </div>');
    }
    $(document).ready(function () {
        console.log('Document ready called');
        $('.school').autocomplete({
            source: "school.php"
        });
        $('#addPos').click(addPositionField);
        $('#addEdu').click(addEducationField);
    });
</script>
</body>
</html>